<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextFerretOS Documentation</title>
    <link rel="icon" type="image/png" href="nfos.png">
    <style>
        :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --text: #c9d1d9; --accent: #58a6ff; --pinned: #f0883e; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; line-height: 1.6; }
        header { background: var(--card); padding: 2rem 1rem; text-align: center; border-bottom: 1px solid var(--border); }
        .logo { width: 50px; margin-bottom: 10px; }
        .container { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .post { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; position: relative; }
        .pinned { border: 2px solid var(--pinned); }
        .badge { background: var(--pinned); color: #000; font-size: 0.7rem; font-weight: bold; padding: 2px 8px; border-radius: 4px; position: absolute; top: -10px; right: 20px; }
        h2 { margin-top: 0; color: var(--accent); }
        .desc { color: #8b949e; font-size: 0.9rem; margin-bottom: 1rem; font-style: italic; }
        .content-img { max-width: 100%; border-radius: 6px; margin: 1rem 0; display: block; border: 1px solid var(--border); }
        b { color: #f0883e; }
        i { color: #aff5b4; }
    </style>
</head>
<body>

<header>
    <img src="nfos.png" alt="OS Logo" class="logo">
    <h1>NextFerretOS Docs</h1>
</header>

<div class="container" id="feed">
    <div style="text-align: center;">Scanning repository...</div>
</div>

<script>
    const REPO_API = "https://api.github.com/repos/NextFerret/nextferret.github.io/contents/nextferretos/docs";
    const RAW_BASE = "https://raw.githubusercontent.com/NextFerret/nextferret.github.io/main/nextferretos/docs/";

    async function loadBlog() {
        const feed = document.getElementById('feed');
        try {
            const res = await fetch(REPO_API);
            const files = await res.json();
            const nftxtFiles = files.filter(f => f.name.endsWith('.nftxt'));
            
            let posts = [];

            for (let file of nftxtFiles) {
                const rawRes = await fetch(RAW_BASE + file.name);
                const text = await rawRes.text();
                posts.push(parseDoc(text, file.name));
            }

            posts.sort((a, b) => b.isPinned - a.isPinned);

            feed.innerHTML = posts.map(p => `
                <article class="post ${p.isPinned ? 'pinned' : ''}">
                    ${p.isPinned ? '<span class="badge">PINNED</span>' : ''}
                    <h2>${p.title}</h2>
                    <div class="desc">${p.description}</div>
                    <div>${p.content}</div>
                </article>
            `).join('');

        } catch (e) {
            feed.innerHTML = "Failed to sync with GitHub.";
        }
    }

    function parseDoc(raw, filename) {
        const get = (key) => {
            const reg = new RegExp(`${key}=(?:%"([\\s\\S]*?)"%|"(.*?)")`);
            const m = raw.match(reg);
            return m ? (m[1] || m[2]) : '';
        };

        let content = get('nextferret_content');
        
        content = content
            .replace(/%&\((.*?)\)&%/g, '<img src="$1" class="content-img">')
            .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
            .replace(/\*(.*?)\*/g, '<i>$1</i>')
            .replace(/\n/g, '<br>');

        return {
            title: get('nextferretblog_title') || filename,
            description: get('nextferret_description'),
            content: content,
            isPinned: raw.includes('pinned="true"')
        };
    }

    loadBlog();
</script>
</body>
</html>
